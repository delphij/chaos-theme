/* ==========================================================================
   CSS VARIABLES
   Global design tokens for colors, spacing, and typography.
   Uses CSS custom properties for easy theme switching and maintenance.
   ========================================================================== */

:root {
  /* Color scheme - Tells browser to use native light UI for controls */
  color-scheme: light;

  /* Color palette - Light mode
     Primary brand colors with Japanese traditional color names */
  --bg: #FAFAFA;                    /* Page background */
  --surface: #FFFFFF;                /* Card/panel surfaces */
  --text: #222222;                   /* Body text */
  --heading: #111111;                /* Headings and titles */
  --muted: #6B6B6B;                  /* Secondary text, captions */
  --primary: #A23E48;                /* 红緋 Hi-iro (primary brand color) */
  --accent: #2E5A88;                 /* 瑠璃色 Ruri-iro (accent color) */
  --paper: #F2E8D5;                  /* 和纸感 (paper texture background) */

  /* Links - Distinct blue palette for accessibility */
  --link: #0066CC;                   /* Default link color */
  --link-hover: #004C99;             /* Link hover state */

  /* UI elements - Borders and backgrounds */
  --table-stripe: #F2F2F2;           /* Alternating table row background */
  --blockquote-fg: #444444;          /* Blockquote text color */
  --border: 1px solid rgba(0,0,0,0.06); /* Subtle border for light mode */

  /* Alert colors - Semantic color system for different message types */
  --alert-note-bg: #F0F4FF;          /* Note/Historical background */
  --alert-note-border: #3366CC;      /* Note border */
  --alert-tip-bg: #F0FFF4;           /* Tip background */
  --alert-tip-border: #228B22;       /* Tip border */
  --alert-important-bg: #FFF8E5;     /* Important background */
  --alert-important-border: #CC6600; /* Important border */
  --alert-warning-bg: #FFF0F0;       /* Warning/Disclaimer background */
  --alert-warning-border: #CC3333;   /* Warning border */
  --alert-caution-bg: #FAF0FF;       /* Caution background */
  --alert-caution-border: #8844AA;   /* Caution border */

  /* Layout dimensions - Spacing and container widths */
  --max-width: 1280px;               /* Maximum container width for header/footer/nav (accommodates 780px article + 280px TOC + gaps) */
  --gutter: 24px;                    /* Horizontal padding */
  --nav-height: 80px;                /* Sticky navigation height for scroll offsets */
  --radius: 10px;                    /* Border radius for cards */
  --radius-sm: 4px;                  /* Small border radius */
  --radius-md: 6px;                  /* Medium border radius */
  --radius-lg: 8px;                  /* Large border radius */

  /* Typography scale - Consistent font sizing system */
  --font-size-base: 16px;            /* Base font size */
  --line-height: 1.8;                /* Line height optimized for CJK text */
  --h1-size: 28px;                   /* Article titles */
  --h2-size: 22px;                   /* Section headings */
  --h3-size: 18px;                   /* Sub-section headings */
  --small-size: 14px;                /* Small text, captions */

  /* Animation timing - Consistent transitions */
  --transition-fast: 0.2s ease;      /* Quick transitions for hover/focus */
  --transition-normal: 0.3s ease;    /* Standard transitions for UI elements */

  /* Z-index layers - Consistent stacking context */
  --z-nav: 40;                       /* Sticky navigation header */
  --z-overlay: 50;                   /* Overlays (menu, TOC) */
  --z-modal: 60;                     /* Floating buttons (TOC toggle) */
  --z-top: 100;                      /* Top layer (skip link, announcements) */

  /* Focus styles - Consistent keyboard navigation indicators */
  --focus-outline: 3px solid rgba(100, 160, 255, 0.18);
  --focus-offset: 2px;
}

/* Dark mode variables
   Complete color palette override for dark theme.
   Maintains visual hierarchy and accessibility in low-light conditions. */
html.dark {
  /* Color scheme - Tells browser to use native dark UI for controls */
  color-scheme: dark;

  --bg: #1C1C1C;                     /* Dark background */
  --surface: #222222;                /* Elevated surfaces */
  --text: #EAEAEA;                   /* Light text on dark */
  --heading: #FFFFFF;                /* High-contrast headings */
  --muted: #A8A8A8;                  /* Muted text */
  --primary: #FF6F61;                /* 珊瑚橙 (coral orange) */
  --accent: #8AB4F8;                 /* Lighter blue for dark mode */
  --paper: #2A2A2A;                  /* Subtle background variation */
  --link: #4DA6FF;                   /* Brighter link for contrast */
  --link-hover: #80C1FF;             /* Link hover in dark mode */
  --table-stripe: #242424;           /* Darker stripe for tables */
  --blockquote-fg: #CCCCCC;          /* Lighter quote text */
  --border: 1px solid rgba(255,255,255,0.04); /* Subtle dark border */

  /* Alert colors adapted for dark mode with higher contrast */
  --alert-note-bg: #1E2A40;
  --alert-note-border: #6699FF;
  --alert-tip-bg: #1F2D1F;
  --alert-tip-border: #66CC66;
  --alert-important-bg: #332B1E;
  --alert-important-border: #FFB84D;
  --alert-warning-bg: #3A1E1E;
  --alert-warning-border: #FF6666;
  --alert-caution-bg: #2A1E33;
  --alert-caution-border: #B266CC;
}

/* ==========================================================================
   BASE STYLES
   Foundation styles for html and body elements.
   Sets up font stack, smoothing, and Chinese typography features.
   ========================================================================== */

html {
  height: 100%;                      /* Full viewport height */
  scroll-behavior: smooth;           /* Smooth scrolling for anchor links */
}

/* Respect user's motion preferences */
@media (prefers-reduced-motion: reduce) {
  html {
    scroll-behavior: auto;           /* Instant scrolling for reduced motion */
  }
}

body {
  height: 100%;                      /* Full viewport height */

  /* Font stack: Noto Sans SC for Chinese, then system fonts as fallback */
  font-family: "Noto Sans SC", -apple-system, BlinkMacSystemFont, "Microsoft YaHei", sans-serif;
  background: var(--bg);
  color: var(--text);
  font-size: var(--font-size-base);
  line-height: var(--line-height);

  /* Font smoothing for better rendering on macOS and WebKit browsers */
  -moz-osx-font-smoothing: grayscale;
  -webkit-font-smoothing: antialiased;

  /* Chinese text best practices - Modern CSS features for CJK typography
     - text-autospace: Automatic spacing between CJK and Latin characters
     - hanging-punctuation: Allow punctuation to hang outside margins
     - word-break: Smart line breaking at natural phrase boundaries */
  text-autospace: normal;
  hanging-punctuation: first allow-end last;
  word-break: auto-phrase;
}

/* ==========================================================================
   TYPOGRAPHY
   Text styling hierarchy including headings, paragraphs, links, and lists.
   Optimized for readability in both English and Chinese.
   ========================================================================== */

/* Headings - Shared styles for all heading levels */
h1,
h2,
h3 {
  color: var(--heading);
  font-weight: 700;
}

/* H1 - Page and article titles */
h1 {
  font-size: var(--h1-size);
  margin: 12px 0 10px;
  font-weight: 800;
  letter-spacing: -0.01em;           /* Tighter spacing for large text */
}

/* H2 - Major section headings */
h2 {
  font-size: var(--h2-size);
  margin: 20px 0 8px;
}

/* H3 - Sub-section headings */
h3 {
  font-size: var(--h3-size);
  margin: 16px 0 6px;
}

/* Paragraphs - Body text with orphan/widow control for better typography */
p {
  margin: 0 0 1em;
  orphans: 2;                        /* Minimum 2 lines at bottom of column */
  widows: 2;                         /* Minimum 2 lines at top of column */
}

/* Links - Dotted underline with smooth transition to solid on hover */
a {
  color: var(--link);
  text-decoration: none;
  border-bottom: 1px dotted var(--link);
  transition: border-color var(--transition-fast), color var(--transition-fast);
}

a:hover {
  color: var(--link-hover);
  border-bottom-style: solid;
  border-bottom-color: var(--link-hover);
}

/* Link focus state for keyboard navigation accessibility */
a:focus {
  outline: var(--focus-outline);
  outline-offset: var(--focus-offset);
}

/* Link variants - Plain links without underline for navigation */
.link-plain,
.brand,
nav.main-links a {
  border-bottom: none;
  text-decoration: none;
}

.link-plain:hover,
.brand:hover {
  border-bottom: none;
}

/* Lists - Minimal left padding with tabular numerals for alignment
   Uses hanging indent: list markers appear in the margin, not in text area */
ul,
ol {
  margin: 1em 0;                      /* Consistent spacing before and after lists */
  font-variant-numeric: tabular-nums; /* Consistent number width */
}

ul {
  padding-left: 15px;                 /* Minimal padding for hanging bullets */
}

/* ==========================================================================
   LAYOUT - CONTAINER
   Main content container with responsive max-width and horizontal padding.
   ========================================================================== */

.container {
  max-width: var(--max-width);
  margin: 28px auto;
  padding: 0 var(--gutter);
}

/* Account for sticky header when jumping to anchors */
#main-content {
  scroll-margin-top: var(--nav-height); /* Offset for sticky navigation */
}

/* Headings with IDs (used for table of contents anchors) */
h1[id],
h2[id],
h3[id],
h4[id],
h5[id],
h6[id] {
  scroll-margin-top: var(--nav-height); /* Offset for sticky navigation */
}

/* ==========================================================================
   LAYOUT - NAVIGATION
   Sticky header with blur effect and flexbox-based navigation menu.
   ========================================================================== */

/* Site navigation - Sticky header with backdrop blur */
.site-nav {
  width: 100%;
  background: linear-gradient(180deg, transparent, rgba(0, 0, 0, 0.02));
  -webkit-backdrop-filter: blur(6px); /* Safari < 18 compatibility */
  backdrop-filter: blur(6px);
  position: sticky;
  top: 0;
  z-index: var(--z-nav);
  border-bottom: var(--border);
}

/* Navigation inner container - Flexbox layout for brand and menu */
.nav-inner {
  max-width: calc(var(--max-width) + 2 * var(--gutter));
  margin: 0 auto;
  padding: 12px var(--gutter);
  display: flex;
  align-items: center;
  gap: 12px;
}

/* Brand/logo - Site name with optional subtitle */
.brand {
  font-weight: 700;
  letter-spacing: 0.02em;
  color: var(--heading);
  display: flex;
  align-items: baseline;
  gap: 10px;
}

.brand .subtitle {
  font-size: var(--small-size);
  color: var(--muted);
  margin-left: 6px;
  font-weight: 500;
}

.main-title {
  font-size: var(--h3-size);
}

/* Navigation links - Right-aligned menu items */
nav.main-links {
  margin-left: auto;                 /* Push to right side */
  display: flex;
  gap: 14px;
  align-items: center;
}

nav.main-links a {
  color: var(--muted);
  font-weight: 600;
}

nav.main-links a:hover {
  color: var(--primary);
}

/* Base icon button styles - Shared by theme toggle and menu toggle */
.btn-icon {
  border: 0;
  cursor: pointer;
  font-weight: 600;
  padding: 6px 8px;
  border-radius: var(--radius-md);
}

.btn-icon:hover {
  background: var(--paper);
}

/* Theme toggle button - Dark/light mode switcher */
.theme-toggle {
  background: transparent;
}

/* Shared overlay styles for modals and dropdowns - consistent with header glass effect */
.overlay-blur {
  -webkit-backdrop-filter: blur(12px);
  backdrop-filter: blur(12px);
}

/* Fallback for browsers without backdrop-filter - use solid background for readability */
@supports not (backdrop-filter: blur(12px)) {
  .overlay-blur {
    background: var(--bg);
  }
}

/* Menu toggle button - Hamburger menu for mobile */
.menu-toggle {
  display: none;                     /* Hidden by default on desktop */
  font-size: 20px;
  line-height: 1;
  color: var(--heading);             /* Use heading color for visibility in both modes */
}

.menu-toggle:hover {
  color: var(--primary);
}

/* ==========================================================================
   LAYOUT - TABLE OF CONTENTS (TOC)
   Sticky sidebar TOC for article pages with responsive behavior.
   Desktop: right sidebar, Tablet: collapsible top, Mobile: overlay.
   ========================================================================== */

/* 3-column layout for article pages
   Article column: 780px max width provides optimal line length for readability
   - Accommodates ~72-76 character code blocks (76 chars × 8.4px/char ≈ 640px + padding)
   - Provides comfortable reading width for prose (~85-95 characters at 16px)
   TOC column: 280px for navigation
   Left column: flexible spacing */
.content-layout {
  display: grid;
  grid-template-columns: 1fr minmax(0, 780px) 280px;
  gap: 40px;
  align-items: start;
}

/* When no TOC present on desktop, make right column equal to left for balanced spacing
   Breakpoint calculation: 780px article + 280px TOC + 40px gap + ~100px left padding ≈ 1200px minimum */
@media (min-width: 1200px) {
  .content-layout:not(:has(.toc-wrapper)) {
    grid-template-columns: 1fr minmax(0, 780px) 1fr;
  }
}

/* Article takes center column */
article.post {
  grid-column: 2;
  min-width: 0;                      /* Allow grid item to shrink below content size */
}

/* TOC wrapper in right column - sticky container */
.toc-wrapper {
  grid-column: 3;
  position: sticky;
  top: var(--nav-height);            /* Below sticky header */
  align-self: start;                 /* Start at top of grid */
  max-height: calc(100dvh - 100px);  /* Dynamic viewport height for mobile */
}

/* TOC container - content styling */
.toc {
  max-height: calc(100dvh - 100px);  /* Match wrapper height */
  overflow-y: auto;
  padding: 16px;
  background: var(--surface);
  border: var(--border);
  border-radius: var(--radius-lg);
  contain: layout style;             /* Optimize rendering performance */
}

/* TOC title */
.toc-title {
  font-size: 14px;
  font-weight: 700;
  color: var(--heading);
  margin: 0 0 12px 0;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

/* TOC content styling */
.toc-content nav {
  font-size: 14px;
  line-height: 1.6;
}

.toc-content ul {
  list-style: none;
  padding-left: 0;
  margin: 0;
}

.toc-content ul ul {
  padding-left: 16px;
  margin-top: 4px;
}

.toc-content li {
  margin: 4px 0;
}

.toc-content a {
  color: var(--muted);
  text-decoration: none;
  border-bottom: none;
  display: block;
  padding: 4px 8px;
  border-radius: var(--radius-sm);
  transition: color var(--transition-fast), background var(--transition-fast);
}

.toc-content a:hover {
  color: var(--primary);
  background: var(--paper);
}

/* Active section highlighting */
.toc-content a.active {
  color: var(--primary);
  font-weight: 600;
  background: var(--paper);
}

/* TOC toggle button - hidden on desktop */
.toc-toggle {
  display: none;
}

/* ==========================================================================
   LAYOUT - FOOTER
   Centered footer with muted text for copyright and supplementary info.
   ========================================================================== */

footer.site-foot {
  max-width: var(--max-width);
  margin: 40px auto 80px;
  padding: 24px var(--gutter);
  color: var(--muted);
  font-size: 13px;
  text-align: center;
}

/* ==========================================================================
   CONTENT - ARTICLES
   Article-specific styling with Chinese typography enhancements.
   Includes justified text and CJK spacing optimizations.
   ========================================================================== */

article.post {
  background: transparent;
  color: var(--text);

  /* Chinese typography enhancements for professional text layout
     - text-align: justify - Creates aligned character grids (standard in Chinese)
     - text-spacing-trim: Optimizes CJK punctuation spacing (Chrome 133+, Safari 18.2+)
     - line-break: strict - Enforces strict CJK line-breaking rules */
  text-align: justify;
  text-spacing-trim: space-all;
  line-break: strict;
}

/* Article metadata - Post date, reading time, etc. */
article .meta {
  color: var(--muted);
  font-size: 13px;
  margin-bottom: 8px;
}

/* ==========================================================================
   COMPONENTS - TABLES
   Responsive table styling with striped rows and inverted header colors.
   ========================================================================== */

table {
  width: 100%;
  margin: 1em 0;
}

/* Table cells - Consistent padding and borders */
table th,
table td {
  border-bottom: 1px solid var(--border);
  padding: 0.75rem;
  text-align: left;
  vertical-align: top;
}

/* Table header - Inverted colors for visual hierarchy */
table thead th {
  border-bottom: 2px solid var(--border);
  vertical-align: bottom;
  background-color: var(--text);
  color: var(--bg);
}

/* Multiple table bodies - Visual separator */
table tbody + tbody {
  border-top: 2px solid var(--border);
}

/* Striped rows - Zebra striping for easier row scanning */
table tbody tr:nth-of-type(even) {
  background-color: var(--table-stripe);
}

/* ==========================================================================
   COMPONENTS - BLOCKQUOTES
   Styled quote blocks with left border accent and background tint.
   Lists within quotes have extra padding for proper alignment.
   ========================================================================== */

blockquote {
  border-left: 4px solid var(--accent);
  margin: 16px 0;
  padding: 12px 16px;
  background: var(--paper);
  border-radius: var(--radius-md);
  color: var(--blockquote-fg);
  font-style: normal;
  font-size: 0.95em;
}

/* Lists inside blockquotes - Extra padding to align with quote content */
blockquote ol,
blockquote ul {
  padding-left: 30px;                /* Double normal padding for visual alignment */
}

/* ==========================================================================
   COMPONENTS - ALERTS
   Semantic alert boxes for notes, tips, warnings, and other callouts.
   Color-coded for different message types with consistent styling.
   ========================================================================== */

/* Base alert styles - Left border with rounded corners */
.alert {
  border-left: 4px solid;
  padding: 1em;
  margin: 1.5em 0;
  border-radius: 0.5em;
  font-size: var(--font-size-base);
  line-height: var(--line-height);
  contain: layout style;             /* Optimize rendering performance */
}

/* Alert variants - Different colors for semantic meaning */
.alert-note,
.alert-historical {
  background: var(--alert-note-bg);
  border-color: var(--alert-note-border);
}

.alert-tip {
  background: var(--alert-tip-bg);
  border-color: var(--alert-tip-border);
}

.alert-important {
  background: var(--alert-important-bg);
  border-color: var(--alert-important-border);
}

.alert-warning,
.alert-disclaimer {
  background: var(--alert-warning-bg);
  border-color: var(--alert-warning-border);
}

.alert-caution {
  background: var(--alert-caution-bg);
  border-color: var(--alert-caution-border);
}

/* ==========================================================================
   COMPONENTS - CODE HIGHLIGHTING
   Syntax highlighting styles for code blocks using Chroma.
   Includes line numbers, horizontal scroll, and selection behavior.
   ========================================================================== */

/* Code blocks use smaller font for compact display
   Inline code (not in pre) keeps body font size */
pre {
  font-size: var(--small-size);
}

/* Code block wrapper - Scroll container for wide code */
.highlight pre {
  margin: 0;
  padding: 12px;
  overflow-x: auto;
  max-width: 100%;
}

/* Chroma structural styles - Layout for syntax highlighting components */

/* Line number links - Remove default link styling */
.chroma .lnlinks {
  outline: none;
  text-decoration: none;
  color: inherit;
}

/* Line number table cells - Reset spacing */
.chroma .lntd {
  vertical-align: top;
  padding: 0;
  margin: 0;
  border: 0;
}

/* Line number table - Horizontal scroll container with hanging indent on desktop only */
.chroma .lntable {
  border-spacing: 0;
  padding: 0;
  margin: 0;
  border: 0;
  overflow-x: auto;
  display: block;
  max-width: 100%;                   /* Keep code column at original width */
}

/* Hanging indent for line numbers on desktop (≥1200px) where there's space
   On smaller screens, line numbers stay inline to prevent cutoff */
@media (min-width: 1200px) {
  .chroma .lntable {
    margin: 0 0 0 -3em;              /* Shift left so line numbers hang in margin */
  }
}

/* Line numbers - Unselectable with consistent spacing */
.chroma .lnt,
.chroma .ln {
  white-space: pre;
  -webkit-user-select: none;
  user-select: none;
  margin-right: 0;               /* Reduced gap between numbers and code */
  padding: 0 0 0 0.4em;
}

/* Code lines - Flex layout for alignment */
.chroma .line {
  display: flex;
}

/* Line number column - page background for hanging indent effect
   Apply to column, pre element, and line number elements
   Works for both screen and print (var(--bg) adapts automatically) */
.highlight .lntable .lntd:first-child,
.highlight .lntable .lntd:first-child pre,
.chroma .lntd:first-child,
.chroma .lntd:first-child pre,
.chroma .lnt,
.chroma .ln {
  background: var(--bg);
}

/* Line number column spacing - depends on hanging indent */
.highlight .lntable .lntd:first-child,
.chroma .lntd:first-child {
  padding-right: 1em;                /* Default spacing for inline layout on small screens */
}

@media (min-width: 1200px) {
  .highlight .lntable .lntd:first-child,
  .chroma .lntd:first-child {
    padding-right: 0;                /* Minimal gap with hanging indent on desktop */
  }
}

/* ==========================================================================
   COMPONENTS - PAGINATION
   Previous/next navigation for paginated content.
   Flexbox layout with space-between alignment.
   ========================================================================== */

.pager {
  display: flex;
  justify-content: space-between;
  gap: 10px;
  margin: 28px 0;
  padding: 0;
}

/* Pagination items - Remove list styling */
.pager li {
  list-style: none;
  display: inline-block;
  margin: 0;
  padding: 0;
}

/* Pagination links - Button-style with border */
.pager a {
  display: inline-block;
  padding: 8px 12px;
  border-radius: var(--radius-lg);
  font-weight: 700;
  border: var(--border);
  color: var(--heading);
}

.pager a:hover {
  background: var(--paper);
  color: var(--primary);
}

/* Pagination alignment - Previous left, next right */
.pager .page-prev {
  text-align: left;
}

.pager .page-next {
  margin-left: auto;
  text-align: right;
}

/* ==========================================================================
   SPECIALIZED - CHINESE TYPOGRAPHY
   Advanced typography features for Chinese text including ruby annotations
   (phonetic guides) and emphasis dots for strong emphasis.
   ========================================================================== */

/* Ruby annotations - Phonetic notation marks
   Used for showing pronunciation above Chinese characters */
ruby {
  ruby-position: over;               /* Position annotations above base text */
  font-variant-east-asian: ruby;
}

/* Ruby base text - The main character */
rb {
  font-size: 1em;
}

/* Ruby text - The small pronunciation guide */
rt {
  font-size: 0.65em;
  line-height: 1;
  color: var(--muted);
  font-weight: normal;
  letter-spacing: 0.05em;
  padding: 0 0.1em;
}

/* Chinese emphasis dots - Traditional emphasis marks
   Uses text-emphasis instead of bold for CJK text */
strong {
  font-weight: bold;
  text-emphasis: filled dot;         /* Adds dots below characters */
  text-emphasis-position: under;     /* Position below for horizontal text */
}

/* ==========================================================================
   ACCESSIBILITY
   Focus states and keyboard navigation support.
   ========================================================================== */

/* Screen reader only - Visually hidden but accessible to assistive tech */
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}

/* Print-only content - Hidden on screen, visible in print */
.print-only {
  display: none;
}

/* Skip to content link - Hidden until focused via keyboard */
.skip-link {
  position: absolute;
  top: -100%;                        /* Completely off-screen */
  left: 0;
  padding: 8px 16px;                 /* Maintained for smooth transition */
  z-index: var(--z-top);
  transition: top var(--transition-fast), opacity var(--transition-fast);
  opacity: 0;                        /* Invisible by default */
}

.skip-link:focus {
  top: 0;
  opacity: 1;
  background: var(--primary);        /* Visual styles only when focused */
  color: var(--surface);
  font-weight: 600;
  border-radius: 0 0 var(--radius-sm) 0;
  border-bottom: none;
  outline: var(--focus-outline);
  outline-offset: var(--focus-offset);
}

button:focus {
  outline: var(--focus-outline);
  outline-offset: var(--focus-offset);
}

/* ==========================================================================
   RESPONSIVE / MEDIA QUERIES
   Breakpoints for tablet and mobile devices.
   Adjusts layout, typography, and navigation for smaller screens.
   ========================================================================== */

/* Tablet breakpoint - Collapse 3-column layout to single column
   Container max-width stays at 1280px; article grid already constrains content to 780px */
@media (max-width: 1199px) {

  .nav-inner {
    padding: 10px 16px;
  }

  article h1 {
    font-size: 24px;
  }

  /* TOC: Switch to mobile overlay behavior on tablet */
  .content-layout {
    grid-template-columns: 1fr;
    gap: 24px;
  }

  article.post {
    grid-column: 1;
  }

  /* TOC: Use mobile overlay behavior on tablet */
  .toc-toggle {
    display: block;
    position: fixed;
    bottom: 24px;
    right: 24px;
    width: 48px;
    height: 48px;
    border-radius: 50%;
    background: var(--primary);
    color: white;
    border: none;
    cursor: pointer;
    font-size: 20px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    z-index: var(--z-modal);
    transition: transform var(--transition-normal), box-shadow var(--transition-normal);
  }

  .toc-toggle:hover {
    transform: scale(1.1);
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.4);
  }

  .toc-toggle .toc-icon {
    display: block;
    line-height: 1;
  }

  .toc-wrapper {
    grid-column: 1;
    position: relative;
    top: 0;
    max-height: none;
  }

  .toc {
    display: none;
    position: fixed;
    top: var(--nav-height);
    left: 0;
    right: 0;
    bottom: 0;
    max-height: calc(100dvh - var(--nav-height));
    z-index: var(--z-overlay);
    overflow-y: auto;
    padding: 24px;
    border: 0;
    border-top: var(--border);
    border-radius: 0;
    /* Note: backdrop-filter from .overlay-blur class */
  }

  .toc.toc-open {
    display: block;
  }
}

/* Mobile breakpoint - Full width, hamburger menu */
@media (max-width: 600px) {
  :root {
    --max-width: 100%;
  }

  .nav-inner {
    gap: 8px;
    position: relative;              /* For absolute positioning of menu */
  }

  /* Brand comes first, takes remaining space */
  .brand {
    font-size: 16px;
    flex: 1;                         /* Take remaining space */
  }

  /* Show hamburger menu button on mobile - positioned before theme toggle */
  .menu-toggle {
    display: block;
  }

  /* Hide main navigation by default on mobile */
  nav.main-links {
    display: none;
    flex-direction: column;
    position: absolute;              /* Overlay instead of pushing content */
    top: 100%;                       /* Position below nav-inner */
    left: 0;
    right: 0;
    gap: 8px;
    padding: 12px var(--gutter);
    border-top: var(--border);
    z-index: var(--z-overlay);       /* Above content, below modals */
    /* Note: backdrop-filter from .overlay-blur class */
  }

  /* Show navigation when menu is open */
  nav.main-links.menu-open {
    display: flex;
  }

  /* Stack navigation links vertically on mobile */
  nav.main-links a {
    padding: 8px 12px;
  }

  nav.main-links a:hover {
    color: var(--primary);
  }

  /* Hide subtitle on mobile to save space */
  .brand .subtitle {
    display: none;
  }

  /* TOC styles inherited from tablet breakpoint */
}

/* ==========================================================================
   PRINT STYLES
   Optimized layout for printing articles.
   Removes navigation, interactive elements, and applies print-friendly colors.
   ========================================================================== */

@media print {
  /* Force light mode colors and Chinese print typography standards */
  :root {
    color-scheme: light;
    --bg: #FFFFFF;
    --surface: #FFFFFF;
    --text: #000000;
    --heading: #000000;
    --muted: #666666;
    --border: 1px solid #CCCCCC;
    --blockquote-fg: #333333;
    --paper: #F5F5F5;

    /* Print typography - Chinese standards (10.5pt body with proportional headings)
       Ratios - h1:h2:h3:body = 1.7:1.3:1.1:1 */
    --font-size-base: 10.5pt;        /* Standard Chinese business/print size */
    --line-height: 1.75;             /* Slightly tighter than screen (1.8) */
    --h1-size: 17.85pt;              /* 10.5pt × 1.7 */
    --h2-size: 13.65pt;              /* 10.5pt × 1.3 */
    --h3-size: 11.55pt;              /* 10.5pt × 1.1 */
    --small-size: 9pt;               /* ~85.7% of base (metadata, captions) */
  }

  /* Hide interactive and navigation elements */
  .site-nav,
  .site-foot,
  .skip-link,
  .theme-toggle,
  .menu-toggle,
  .toc-toggle,
  .toc-wrapper,
  .pager,
  #remark42,
  button {
    display: none !important;
  }

  /* Hide reading stats (word count/read time) - redundant with page numbers */
  .reading-stats {
    display: none !important;
  }

  /* Reset container for full-width printing with page margins */
  .container {
    max-width: 100%;
    margin: 0;
    padding: 0 0.5in;                /* Horizontal padding to prevent clipping hanging list markers */
  }

  /* Remove grid layout for article pages */
  .content-layout {
    display: block;
  }

  /* Article styling for print */
  article.post {
    max-width: 100%;
  }

  /* Better paragraph handling with URLs */
  p {
    orphans: 3;                      /* Prevent short orphans with URLs */
    widows: 3;                       /* Prevent short widows with URLs */
  }

  /* Improve heading breaks - avoid page breaks immediately after headings */
  h1, h2, h3 {
    page-break-after: avoid;
    break-after: avoid-page;
  }

  /* Images and blockquotes should not break */
  img, blockquote {
    page-break-inside: avoid;
    break-inside: avoid;
  }

  /* Code blocks - allow breaking for large blocks, but prefer keeping together */
  pre, .highlight {
    page-break-inside: auto;
    break-inside: auto;
  }

  /* Smart breaking for code blocks using orphan/widow control
     - Blocks with < 14 lines will stay together (avoids wasted space)
     - Blocks with >= 14 lines can break across pages
     - Ensures minimum 7 lines on each side of break (prevents 1-2 line fragments) */
  pre {
    orphans: 7;
    widows: 7;
  }

  /* Avoid breaking a code block immediately after a heading */
  h1 + pre, h2 + pre, h3 + pre,
  h1 + .highlight, h2 + .highlight, h3 + .highlight {
    page-break-before: avoid;
    break-before: avoid-page;
  }

  /* Remove link underlines for cleaner print */
  a {
    border-bottom: none;
    color: var(--text);
  }

  /* Print footnote styling - External links converted to footnotes */

  /* Footnote superscript reference numbers in text [1] [2] etc. */
  .print-footnote-ref {
    font-size: 0.75em;
    vertical-align: super;
    color: var(--primary);
    font-weight: 600;
    margin-left: 0.1em;
    text-decoration: none;
    border-bottom: 1px solid var(--primary);
  }

  /* Clickable footnote numbers in References section (1. 2. etc.) */
  .print-footnote-backref {
    color: var(--primary);
    font-weight: 700;
    text-decoration: none;
    border-bottom: 1px solid var(--primary);
    margin-right: 0.5em;
  }

  /* Print references section */
  .print-only {
    display: block;
    margin-top: 3em;
    padding-top: 1em;
    border-top: 2px solid var(--border);
  }

  #print-references h2 {
    font-size: 16px;
    font-weight: 700;
    margin-bottom: 1em;
  }

  #print-references ol {
    font-size: 0.85em;
    line-height: 1.6;
    padding-left: 2em;
    margin: 0;
  }

  #print-references li {
    margin-bottom: 0.5em;
    word-break: break-all;
    overflow-wrap: break-word;
    page-break-inside: avoid;
  }

  /* Disable CSS containment for proper print layout */
  .alert {
    contain: none;                   /* Prevent margin/spacing issues in print */
  }

  /* Blockquotes - Remove decorative border for cleaner print */
  blockquote {
    border-left: none;
    background: transparent;
    margin: 0.5em 0;
    padding-left: 1em;
  }

  /* Code styling - Consolidated styles for all code elements */
  code {
    background: var(--paper);
  }

  /* Remove background from code inside code blocks */
  .highlight code,
  pre code {
    background: transparent;
  }

  /* Code block containers - Shared margin and padding */
  .highlight,
  pre:not(.highlight pre),
  blockquote .highlight {
    margin: 0.5em 0;
    padding: 8px;
    background: var(--paper);
  }

  /* Pre elements - Reset styles (container provides styling) */
  .highlight pre,
  blockquote pre {
    margin: 0;
    padding: 0;
    background: transparent;
  }

  /* Code blocks WITHOUT line numbers - restore padding */
  .highlight pre:not(.chroma) {
    padding: 8px;
  }

  /* Chroma table structures - Remove all borders and spacing */
  .chroma .lntable {
    display: table;
    border: none;
    border-spacing: 0;
    border-collapse: collapse;
    margin: 0 0 0 -3em;              /* Hanging indent for print too */
    padding: 0;
    width: 100%;
  }

  .chroma .lntable tbody,
  .chroma .lntable tr,
  .chroma .lntd {
    border: none;
    margin: 0;
    padding: 0;
  }

  .chroma .lntable tbody {
    display: table-row-group;
  }

  .chroma .lntable tr {
    display: table-row;
  }

  .chroma .lntd {
    display: table-cell;
    vertical-align: top;
  }

  /* Line number column padding already set in main styles */

  /* Remove borders and spacing from code column elements only */
  .chroma .lntd:not(:first-child) pre,
  .chroma .lntd:not(:first-child) code,
  .chroma code {
    background: transparent;
    border: none;
    margin: 0;
    padding: 0;
  }

  /* Reset background colors */
  body {
    background: white;
  }
}
